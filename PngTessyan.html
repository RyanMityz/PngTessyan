<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PNGTuber</title>
<style>
body {
  margin: 0;
  background: transparent;
  overflow: hidden;
}
img {
  width: 100%;
  transition: transform 0.08s ease, filter 0.08s ease;
}
</style>
</head>
<body>

<img id="face" src="normal.png">

<script>
const face = document.getElementById("face");
let falando = false;

// Piscar automático
setInterval(() => {
  if (!falando) {
    face.src = "piscar.png";
    setTimeout(()=> face.src="normal.png", 140);
  }
}, 3800);

// Microfone
navigator.mediaDevices.getUserMedia({ audio:true }).then(stream=>{
  const ctx = new AudioContext();
  const mic = ctx.createMediaStreamSource(stream);
  const analyser = ctx.createAnalyser();

  mic.connect(analyser);
  analyser.fftSize = 256;

  const data = new Uint8Array(analyser.frequencyBinCount);

  function loop(){
    analyser.getByteFrequencyData(data);
    let volume = data.reduce((a,b)=>a+b)/data.length;

    // normal fala
    if(volume > 25 && volume <= 45){
      falando = true;
      face.style.transform = "scale(1.08) translateY(-4px)";
      face.style.filter = "brightness(1.4) drop-shadow(0 0 12px white)";
    }

    // grito
    else if(volume > 45){
      falando = true;
      let shakeX = (Math.random()*6)-3;
      let shakeY = (Math.random()*6)-3;
      face.style.transform = `scale(1.12) translate(${shakeX}px, ${shakeY}px)`;
      face.style.filter = "brightness(1.8) drop-shadow(0 0 20px white)";
    }

    // silêncio
    else{
      falando = false;
      face.style.transform = "scale(1)";
      face.style.filter = "brightness(1)";
    }

    requestAnimationFrame(loop);
  }

  loop();
});
</script>

</body>
</html>
